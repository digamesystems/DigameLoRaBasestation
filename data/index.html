<!DOCTYPE HTML><html>
  <head> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!--link rel="preconnect" href="https://fonts.googleapis.com"-->
    <!--link rel="preconnect" href="https://fonts.gstatic.com" crossorigin-->
    <!--link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"-->
      
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="shortcut icon" href="favicon.ico"/>
    <link rel="icon"  type="image/ico" href="favicon.ico">
    <title>%config.deviceName% - (counter)</title>
  </head>

<body>

    <h1>HEIMDALL</h1><br>
    <h3><em>A Next-Generation Traffic Counting Platform</em></h3>
    <h3><em>from D&#237game Systems</em></h3> 
    <hr>
    <br>

    <h2>LoRa-WiFi Base Station<br><em> %config.deviceName% </em></h2>

    <form>
      <p>Welcome. You can use these forms to update system parameters for this LoRa-WiFi base station.</p>
    </form>
    
    <form>
      <H3>Sensor Data</H3>
      <br>
      <table >      
        <thead><th style="width:180px">Name</th><th style="width:150px">Lane 1</th><th style="width:150px">Lane 2</th></thead>
        <tbody>    
          <tr>
            <td><em>%config.sens1Name%</em></td>
            <td><span id="sens1count1">%str1Count%</span></td>
            <td><span id="sens1count2">%str1Count%</span></td>
            
          </tr>
          <tr>
            <td><em>%config.sens2Name%</em></td>
            <td><span id="sens2count1">%str2Count%</span></td>
            <td><span id="sens2count2">%str2Count%</span></td>
          </tr>
          <tr>
            <td><em>%config.sens3Name%</em></td>
            <td><span id="sens3count1">%str3Count%</span></td>
            <td><span id="sens2count2">%str3Count%</span></td>
          </tr>
          <tr>
            <td><em>%config.sens4Name%</em></td>
            <td><span id="sens4count1">%str4Count%</span></td>
            <td><span id="sens2count2">%str4Count%</span></td>
          </tr>
        </tbody>
      </table>
      <br>
      <br>
  
    </form>


    <form action="/generalparams">
        <H3>General</H3><br>
        <label for="devname">Device Name</label>
        <input type="text" id="devname" name="devname" value="%config.deviceName%"><br>

        <br><label>Model</label>
        <br><small><em>%MODEL%</em><br>%MODEL_DESCRIPTION%</small><br>
        
        <br><label>Software Version<br></label><br>
        <small>%SW_VERSION%</small><br>

        <br><label>Uptime (DDD:HH:MM:SS)<br></label><br>
        <small><span id="uptime">%UPTIME%</span></small>
        <br>

        <br><label>MQTT</label>
        <div>
          <br>
          <label for="mqtturl"><small>Server URL</small></label>
          <input type="text" id="mqtturl" name="mqtturl" size="40" value="%config.mqttURL%">
          <br><br>  
          <label for="mqttport"><small>Port</small></label>
          <input type="number" min="1" max="65534" id="mqttport" name="mqttport" value=%config.mqttPort%>
          <br><br>          
          
          <label for="usemqtt"><small>Active</small></label>
          <input type="checkbox" id="usemqtt" name="usemqtt" value="checked" %config.useMQTT%>
          
          <br>
        </div>

        <br><label for="reboot">Reboot</label>
        <input type="checkbox" id="reboot" name="reboot" value="true"><p><br></p>

        <div class="center">
        <input type="submit" value="Submit"></form>
        </div>
    </form>


    <form action="/networkparams">
        <H3>Network</H3>
        <p><em>NOTE: Changes to network settings will be applied after a reboot of the device.</em></p>
        <label>MAC Address</label><p><small><em>%MAC_ADDRESS%</em></small></p><br>
        
        <label for="ssid">Heartbeat Rate (sec)</label>
        <input type="number" min="10" max="65534" id="heartbeatinterval" name="heartbeatinterval" value=%config.heartbeatInterval%><br><br>            

        <label for="ssid">SSID</label>
        <input type="text" id="ssid" name="ssid" value="%config.ssid%"><br><br>

        <label for="password">Password</label>
        <input type="password" id="password" name="password" value="%config.password%"><br><br>

        <label for="serverurl">Server URL</label>
        <input type="text" id="serverurl" name="serverurl" size="40" value="%config.serverURL%"><br><br>
        
        <br>
        <div class="center">
          <input type="submit" value="Submit">
        </div>
    </form>

    <form action="/loraparams">
        <H3>LoRa<br><small>(Low-Power Long-Range Wireless Link)</small></H3>
        <p><em>Strategies for optimizing the parameters for LoRa communication may be found in the product manual. Both the counters and the base station must use the same RF parameters for communication to be successful.</em></p>
        <label for="address">This Base Station Addr</label>
        <input type="number" min="1" max="9" id="address" name="address" value=%config.loraAddress%><br><br>            
        <label for="networkid">Network ID</label>
        <input type="number" min="0" max="16" id="networkid" name="networkid" value=%config.loraNetworkID%><br><br>
        <label for="band">Band</label>
        <input type="number" min="850000000" max="950000000" id="band" name="band" value=%config.loraBand%><br><br>
        <label for="spreadingfactor">Spreading Factor</label>
        <input type="number" min="7" max="12" id="spreadingfactor" name="spreadingfactor" value=%config.loraSF%><br><br>
        <label for="bandwidth">Bandwidth</label>
        <input type="number" min="0" max="9" id="bandwidth" name="bandwidth" value=%config.loraBW% ><br><br>
        <label for="codingrate">Coding Rate</label>
        <input type="number" min="1" max="4" id="codingrate" name="codingrate" value=%config.loraCR% ><br><br>
        <label for="preamble">Preamble</label>
        <input type="number" min="4" max="7" id="preamble" name="preamble" value=%config.loraPreamble% ><br><br>
        <br>
        <div class="center">
            <input type="submit" value="Submit">
        </div>
    </form>

  
    <form action="/sensors">
      <H3>Sensor Definitions</H3>
      <p><em>A base station can support up to four (4) traffic counters. Each counter should have a unique LoRa address to avoid communication errors.</em></p>
      
      <table>      
      <thead><th>Name</th><th>Addr</th></thead>
      <tbody>
      
      <tr>
      <td><input type="text" id="sens1name" name="sens1name" value="%config.sens1Name%"></td>
      <td><input style="width: 3em" type="number" min="10" max="99" id="sens1addr" name="sens1addr" value=%config.sens1Addr%></td>
      </tr>

      <tr>
      <td><input type="text" id="sens2name" name="sens2name" value="%config.sens2Name%"></td>
      <td><input style="width: 3em" type="number" min="10" max="99" id="sens2addr" name="sens2addr" value="%config.sens2Addr%"></td>
       </tr>

      <tr>
      <td><input type="text" id="sens3name" name="sens3name" value="%config.sens3Name%"></td>
      <td><input style="width: 3em" type="number" min="10" max="99" id="sens3addr" name="sens3addr" value="%config.sens3Addr%"></td>
       </tr>

      <tr>
      <td><input type="text" id="sens4name" name="sens4name" value="%config.sens4Name%"></td>
      <td><input style="width: 3em" type="number" min="10" max="99" id="sens4addr" name="sens4addr" value="%config.sens4Addr%"></td>
      </tr>          

      </tbody>
  
      </table>
      <br>
      <br>

      <div class="center"><input type="submit" value="Submit"></div>
  </form>

    <hr>
    <img src="Digame_Logo_Full_Color.png" alt="Digame Logo">
    <p style="text-align:center; font-style:italic ">Copyright 2021, D&#237game Systems. All rights reserved.</p>
  
    
    
  <script>

    setInterval(myTimer, 1000);
    setInterval(mySecTimer, 1000);


    function myTimer() {
      const d = new Date();
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          items = this.responseText.split(','); 
          c1 = parseFloat(items[0]);
          c2 = parseFloat(items[1]);
          c3 = parseFloat(items[2]);
          c4 = parseFloat(items[3]);
          c5 = parseFloat(items[4]);
          c6 = parseFloat(items[5]);
          c7 = parseFloat(items[6]);
          c8 = parseFloat(items[7]);
          
          document.getElementById("sens1count1").innerHTML = c1;
          document.getElementById("sens2count1").innerHTML = c2;
          document.getElementById("sens3count1").innerHTML = c3;
          document.getElementById("sens4count1").innerHTML = c4;
          document.getElementById("sens1count2").innerHTML = c5;
          document.getElementById("sens2count2").innerHTML = c6;
          document.getElementById("sens3count2").innerHTML = c7;
          document.getElementById("sens4count2").innerHTML = c8;  
        };}
      xhttp.open("GET", "/counters", true);
      xhttp.send();
    }

    function mySecTimer(){
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          uptime = this.responseText;//.split(','); 
          //uptime = parseFloat(items[0]);
          document.getElementById("uptime").innerHTML = uptime;  
        };}
      xhttp.open("GET", "/uptime", true);
      xhttp.send();
    }
    
  </script>



</body>

</html>